<!DOCTYPE html>
<html>
<head lang="en">
<meta charset="UTF-8">
<meta name="author" content="lsl">
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="generator" content="webstorm">
<!--移动端响应式-->
<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
<!--支持IE的兼容模式-->
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!--让部分国产浏览器默认采用高速模式渲染页面-->
<meta name="renderer" content="webkit">
<!--页面style css-->
<link rel="stylesheet" href="{MODULE_URL}/weui/weuix.min.css"/>
<link rel="stylesheet" type="text/css" href="{MODULE_URL}style/css/base.css">
<link rel="stylesheet" type="text/css" href="{MODULE_URL}style/css/li.css">
<script src="{MODULE_URL}style/js/jquery-1.8.3.min.js"></script>
<script src="{MODULE_URL}style/js/li.js"></script>
<title>会员登陆</title>
<style type="text/css">
img { border: 0; vertical-align: middle; }
.weui_cell:before{width: 95%}
.login-box{width:100%;overflow:hidden;margin:0 auto;}
.lg-title{width:100%;height:auto;overflow:hidden;font-size:20px;text-align:center; line-height:100px; color:#fff;}

.login-form{width:100%;height:auto; box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box; -o-box-sizing:border-box;}
.common-div{width:100%;height:40px;overflow:hidden;border-radius:4px;-webkit-border-radius:4px;margin-bottom:20px; position:relative;}
.login-user-name,.login-user-pasw{background-color:rgba(255,255,255,0.1);}
.common-div >.common-icon{float:left;width:20px;height:20px;overflow:hidden;margin:10px;}
.common-div >.common-icon img{width:100%;height:auto;}
.common-div >input{width:100%;height:40px; padding:6px 10px 6px 46px;background-color:transparent;border:none;outline:none;font-size:15px;color:#fff; box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box; -o-box-sizing:border-box; position:absolute; left:0; top:0; font-family:Helvetica,STHeiti STXihei, Microsoft JhengHei, Microsoft YaHei, Arial;}
.login-btn{background-color:#e21323;color:#fff;font-size:16px;text-align:center;line-height:40px; display:block;}
.forgets{width:100%;height:auto;margin:0 auto; padding:0 30px;  box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box; -o-box-sizing:border-box;}
.forgets >a{color:#fff;opacity:0.2;font-size:14px;}
.forgets >a +a{float:right;}
.login-oth-btn{border:1px solid #9598a5; color:#9598a5;font-size:16px;text-align:center;line-height:40px; display:block;}
.bgfff{background: none}
.heifeng_p{border: 1px solid #fff;color: #fff;margin-top: 30px}
</style>
</head>
{if $op == 'login'}
<!-- <script src="{MODULE_URL}style/js/jsbridge-mini.js"></script>
<script src="{MODULE_URL}vconsole.min.js"></script>  -->
<body style="background:#323542;">
<div class="login-box">
  <div class="lg-title">欢迎登陆</div>
  <div class="login-form">
    <form action="" method="post" class="form-horizontal form">
        <div class="login-user-name common-div">
            <span class="eamil-icon common-icon">
              <img src="{MODULE_URL}style/images/eamil.png" />
            </span>
            <input type="number" name="data[phone]" value="" placeholder="请输入您的手机号" />        
          </div>
          <div class="login-user-pasw common-div">
            <span class="pasw-icon common-icon">
              <img src="{MODULE_URL}style/images/password.png" />
            </span>
             <input type="password" name="data[password]" value="" placeholder="请输入您的密码" />        
          </div>
          <input name="submit" type="submit" value="登陆" class="login-btn common-div"/>
         
          <a href="{php echo link_url('member', array('op'=>'create'))}" class="login-oth-btn common-div" style="width: 99.5%">免费注册</a>
         <!--  <a href="javascript:;" class="login-oth-btn common-div" id="weixin">微信登陆</a>
          <script type="text/javascript">
            window.vConsole = new window.VConsole();
            // console.info('欢迎使用 vConsole。vConsole 是一个由微信公众平台前端团队研发的 Web 前端开发者面板，可用于展示 console 日志，方便开发、调试。');
            // // var installed = 0;
            $('#weixin').on('click',function(){ 
             
                jsBridge.ready(function () { 
                    console.info(jsBridge.wxLogin) ; 
                    jsBridge.wxLogin(function(succ,obj) {
                        // alert(installed);
                        console.info(JSON.stringify(obj)) ; 
                        if (succ) {
                            //obj 是个 json 对象，如
                            // {
                            //    code:         "qqqqqqqqqqqqqqq",
                            //    openid:       "wwwwwwwwwwwwwww",
                            //    access_token: "aaaaaaaaaaaaaaa",
                            //    userinfo: {
                            //      nickname: "sssssss"
                            //      //...
                            //    }
                            // }
                            //
                            alert(JSON.stringify(obj));
                        }
                    });
                });             
                
            })
              
          </script>  -->
          <input type="hidden" name="token" value="{$_W['token']}" />
      </form>
  </div>    
</div>
{/if}
{if $op == 'create'}
<body>
<div class="weui_tab" style="height:350px;" id="tab1">
    <!-- <div class="weui_navbar" style="height:44px;">
        <div class="weui_navbar_item ">
            手机注册
        </div>
        <div class="weui_navbar_item">
            账号密码注册
        </div>
    </div> -->
    <div class="weui_tab_bd">
        <div class="">
            <form id="form" action="" method="post">
                <div class="weui_cells weui_cells_form">
                    <div class="weui_cell">
                        <div class="weui_cell_hd">
                            <label class="weui_label">手机号</label>
                        </div>
                        <div class="weui_cell_bd weui_cell_primary">
                            <input class="weui_input" name="phone" type="tel" id="phone" required pattern="[0-9]{11}" maxlength="11" placeholder="输入你现在的手机号" emptyTips="请输入手机号" notMatchTips="请输入正确的手机号">
                        </div>
                        <div class="weui_cell_ft">
                            <i class="weui_icon_warn"></i>
                        </div>
                    </div>
                    <div class="weui_cell">
                        <div class="weui_cell_hd">
                            <label class="weui_label">密码</label>
                        </div>
                        <div class="weui_cell_bd weui_cell_primary">
                            <input class="weui_input" name="password" type="password" required placeholder="输入密码" >
                        </div>
                        <div class="weui_cell_ft">
                            <i class="weui_icon_warn"></i>
                        </div>
                    </div>
                    <div class="weui_cell">
                        <div class="weui_cell_hd">
                            <label class="weui_label">确认密码</label>
                        </div>
                        <div class="weui_cell_bd weui_cell_primary">
                            <input class="weui_input" name="password1" type="password" placeholder="输入确认密码">
                        </div>
                        <div class="weui_cell_ft">
                            <i class="weui_icon_warn"></i>
                        </div>
                    </div>
                    {if $settings['sms'] != 3}
                    <div class="weui_cell weui_vcode">
                        <div class="weui_cell_hd">
                            <label class="weui_label">验证码</label>
                        </div>
                        <div class="weui_cell_bd weui_cell_primary">
                            <input class="weui_input" name="code" type="number" placeholder="请输入验证码" tips="请输入验证码">
                        </div>
                        <div class="weui_cell_ft">
                            <i class="weui_icon_warn"></i>
                            <input id="second" class="weui-vcode-btn" type="button" value="获取验证码" style="border: none;background: white;border-left: 1px solid #DCDCDC;" >
                        </div>
                    </div>
                    {/if}
                </div>
                <div class="weui_btn_area">
                    <input name="submit" type="submit" class="weui_btn weui_btn_primary" value="注册">
                    <input type="hidden" name="token" value="{$_W['token']}" />
                </div>
            </form>
        </div>        
    </div>
</div>

<script type="text/javascript">
function addCookie(name,value,expiresHours){ 
    var cookieString=name+"="+escape(value); 
    //判断是否设置过期时间,0代表关闭浏览器时失效
    if(expiresHours>0){ 
        var date=new Date(); 
        date.setTime(date.getTime()+expiresHours*1000); 
        cookieString=cookieString+";expires=" + date.toUTCString(); 
    } 
        document.cookie=cookieString; 
} 
//修改cookie的值
function editCookie(name,value,expiresHours){ 
    var cookieString=name+"="+escape(value); 
    if(expiresHours>0){ 
      var date=new Date(); 
      date.setTime(date.getTime()+expiresHours*1000); //单位是毫秒
      cookieString=cookieString+";expires=" + date.toGMTString(); 
    } 
      document.cookie=cookieString; 
} 
//根据名字获取cookie的值
function getCookieValue(name){ 
      var strCookie=document.cookie; 
      var arrCookie=strCookie.split("; "); 
      for(var i=0;i<arrCookie.length;i++){ 
        var arr=arrCookie[i].split("="); 
        if(arr[0]==name){
          return unescape(arr[1]);
          break;
        }
      } 
       
}
$(function(){
    $("#second").click(function (){
        sendCode($("#second"));
    });
    v = getCookieValue("secondsremained") ? getCookieValue("secondsremained") : 0//获取cookie值
    if(v>0){
        settime($("#second"));//开始倒计时
    }
})
//发送验证码
function sendCode(obj){
    var phonenum = $("#phone").val();
    var result = isPhoneNum();
    if(result){
        $.post("{php echo link_url('member',array('op'=>'check'))}&phone="+phonenum,function(data,status){
            alert(data);          
        });          
        addCookie("secondsremained",60,60);//添加cookie记录,有效时间60s
        settime(obj);//开始倒计时
    }
}
//将手机利用ajax提交到后台的发短信接口
//开始倒计时
var countdown;
function settime(obj) { 
    countdown=getCookieValue("secondsremained");
    if (countdown == 0 || countdown == undefined) {
        obj.attr("disabled", false);
//        obj.removeAttr("disabled");
        obj.val("免费获取验证码"); 
        return;
    } else { 
        obj.attr("disabled", true);
        obj.val("重新发送(" + countdown + ")"); 
        countdown--;
        editCookie("secondsremained",countdown,countdown+1);
    } 
    setTimeout(function() { settime(obj) },1000) //每1000毫秒执行一次
} 

//校验手机号是否合法
function isPhoneNum(){
    var phonenum = $("#phone").val();
    var myreg = /^(((13[0-9]{1})|(15[0-9]{1})|(14[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
    if(!myreg.test(phonenum)){ 
        alert('请输入有效的手机号码！'); 
        return false; 
    }else{
        return true;
    }
}
</script>
{/if} 
{template 'news/footer'} 
</body>
</html>